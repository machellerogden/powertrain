#!/bin/bash
if [ "$(readlink "$0")" == "" ]; then
    pushd `dirname $0` > /dev/null
    export POWERTRAIN_DIR=`pwd -P`
    popd > /dev/null
else
    export POWERTRAIN_DIR=$(readlink "$0" | xargs dirname)
fi
export POWERTRAIN=$POWERTRAIN_DIR/Makefile

if [ -n "$PROJECT_DIR" ] && cat "$PROJECT_DIR/Makefile" > /dev/null 2>&1; then
    export PROJECT_DIR=$PROJECT_DIR
    printf "Using Makefile as specified by \$PROJECT_DIR"
elif cat $(pwd)/Makefile > /dev/null 2>&1; then
    export PROJECT_DIR=$(pwd)
    printf "Using Makefile from current directory"
else
    export PROJECT_DIR=$POWERTRAIN_DIR
    printf "Using default Makefile"
fi
printf " ($PROJECT_DIR/Makefile)\n\n"

make -C $PROJECT_DIR $@ POWERTRAIN_DIR=$POWERTRAIN_DIR PROJECT_DIR=$PROJECT_DIR
